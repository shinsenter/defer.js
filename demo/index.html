<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://picsum.photos">

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>The Defer.js library (@shinsenter/defer.js)</title>
    <meta name="description" content="ðŸ¥‡ A JavaScript micro-library that helps you lazy load (almost) anything. Defer.js is zero-dependency, super-efficient, and Web Vitals friendly.">

    <link rel="stylesheet" href="./demo.css" media="screen">
    <script src="../src/defer.js"></script>
    <!-- <script src="../dist/defer.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
</head>

<body>
    <main>
        <header>
            <h1>The Defer.js (<code>@shinsenter/defer.js</code>)</h1>
            <p>ðŸ¥‡ A JavaScript micro-library that helps you lazy load (almost) anything. Defer.js is zero-dependency, super-efficient, and Web Vitals friendly.</p>

            <ul id="navs">
                <li><a href="#installation">Getting started</a></li>
            </ul>

            <div class="demo-addthis addthis_inline_share_toolbox"></div>
        </header>

        <hr id="installation">

        <section>
            <h2>Get started:</h2>

            <div class="helper">
                See how easy getting Defer.js works on your website!
            </div>

            <div class="example">
                <h3>Quick installation:</h3>
                <div class="helper">
                    Just put a <code>&lt;script&gt;</code> tag pointing to
                    <a target="_blank" title="defer.min.js"
                        href="https://cdn.jsdelivr.net/npm/@shinsenter/defer.js@3.6.0/dist/defer.min.js">the library URL</a>
                    just below the opening <code>&lt;head&gt;</code> tag of your page.
                    Because <code>defer.min.js</code> is optimized to a very tiny file size,
                    you can even inline entire the library to save one HTTP request.
                </div>
                <div class="demo">
<!-- Copy the script from the below URL -->
<!-- https://cdn.jsdelivr.net/npm/@shinsenter/defer.js@3.6.0/dist/defer.min.js -->
<script>/* then replace this comment block with the content of defer.min.js here */</script>

<!-- If your website still runs on legacy browsers like Internet Explorer 9, -->
<script>'IntersectionObserver'in window||document.write('<script defer src="https://cdn.jsdelivr.net/npm/@shinsenter/defer.js@3.6.0/dist/polyfill.min.js"><\/script>');</script>
                </div>
            </div>
        </section>

        <section>
            <h2>Fully defer <code>&lt;script&gt;</code> tags:</h2>

            <div class="helper">
                Slow scripts (third-party add-ons etc.) may cause
                <a target="_blank" title="Learn more about Web Vitals" href="https://web.dev/vitals/">Web Vitals</a>
                issues in real scenarios.
                <br>
                Fully deferring <code>&lt;script&gt;</code> tags may help your website prevent those Web Vitals things.
            </div>

            <div class="example">
                <h3>Using magic <mark><code>type="deferjs"</code></mark> attribute:</h3>
                <div class="helper">
                    You can easily fully defer any <code>script</code> tag by setting its <code>type</code> attribute to <code>deferjs</code>.
                    <br>
                    This trick also works perfectly with <code>&lt;script src&gt;</code> tags.
                    <br>
                    <strong>Note: </strong>
                    Lazy loading behavior changed since v3.0 when you set <code>Defer.lazy=true</code>. <br>
                    <code>&lt;script&gt;</code> tags with <code>type="deferjs"</code>
                    will not execute unless the user starts interacting with your page.
                    <br>
                    <strong>Note: </strong>
                    <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/preload" target="_blank">Resource hints</a>
                    feature was added since v3.2 as it is recommended to prevent issues called
                    <a href="https://blog.cloudflare.com/too-old-to-rocket-load-too-young-to-die/#quirksitamingthewaterfall" target="_blank">Taming the Waterfall</a>.
                    This feature is discussed at <a href="https://code.shin.company/defer.js/issues/112" target="_blank">#112</a>.
                </div>
                <div class="demo">
<script type="deferjs">
    // your JavaScript will still be here,
    // but it will not run unless the user starts interacting with your page.
    console.info('This script is lazy loaded with type="deferjs" attribute.');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Using your value for the type attribute, such as <mark><code>type="my-magic"</code></mark>:</h3>
                <div class="helper">
                    If you hate using the <mark><code>type="deferjs"</code></mark> attribute,
                    you can even choose yours.
                    <br>
                    <code>Defer.all(cssSelector, [delay], [waitForUserAction])</code>
                    <br>
                    <strong>Note: </strong>
                    Lazy loading behavior changed since v3.0
                    when you set <code>Defer.lazy=true</code> or <code>waitForUserAction=true</code>. <br>
                    <code>&lt;script&gt;</code> tags deferred with this technique
                    will not execute unless the user starts interacting with your page.
                    <br>
                    <strong>Note: </strong>
                    <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/preload" target="_blank">Resource hints</a>
                    feature was added since v3.2 as it is recommended to prevent issues called
                    <a href="https://blog.cloudflare.com/too-old-to-rocket-load-too-young-to-die/#quirksitamingthewaterfall" target="_blank">Taming the Waterfall</a>.
                    This feature is discussed at <a href="https://code.shin.company/defer.js/issues/112" target="_blank">#112</a>.
                </div>
                <div class="demo">
<script type="my-magic">
    // your JavaScript will still be here,
    // but it will not run unless the user starts interacting with your page.
    console.log(
        'This script is lazy loaded with type="my-magic" attribute ' +
        '5 seconds after the user started interacting with your page.'
    );
</script>

<!-- Place the below line after all other script tags -->
<!-- The 2nd argument means those script tags will be delayed 5000ms -->
<script>
    Defer.all('script[type="my-magic"]', 5000);
</script>
                </div>
            </div>

            <div class="example">
                <h3>Using the <code>Defer.all()</code> method for script tags with <code>src</code> attribute:</h3>
                <div class="helper">
                    Your scripts will work perfectly when mixing inline scripts
                    and script tags with an <code>src</code> attribute,
                    like the below example.
                    <br>
                    The library will defer the load of tippy.js until the user starts interacting,
                    when the user moves his/her mouse on the button, a tooltip will show.
                </div>
                <div class="demo">
<button id="tooltip-button">My button</button>
<script type="myscript" src="https://unpkg.com/@popperjs/core@2"></script>
<script type="myscript" src="https://unpkg.com/tippy.js@6"></script>
<script type="myscript">
    tippy('#tooltip-button', { content: 'Hello from Defer.js!' });
</script>
<script>
    Defer.all('script[type="myscript"]', 500, true);
</script>
                </div>
            </div>
        </section>

        <hr id="examples">

        <section>
            <h2><code>Defer(functionRef, [delay], [waitForUserAction])</code></h2>

            <div class="helper">
                Heavy DOM manipulations may cause render-blocking issues in real scenarios.
                <br>
                Wrapping your script with <code>Defer()</code> may help your website prevent render-blocking issues.
            </div>

            <div class="example">
                <h3>Basic usage:</h3>
                <div class="helper">
                    <code>"Code:"</code> blocks will be attached as soon as this page finished loading.
                </div>
                <div class="demo">
<script>
    function generate_code_blocks () {
        // jQuery is used in this example to perform some DOM manipulations.
        $('.demo').each(function() {
            var code = $('<pre><code class="language-html"></code></pre>');
            var demo = $(this);
            var html = demo.html().trim().replace(/ {4}/g, '  ');

            code.children().text(html);
            demo.append(code);
        });

        console.info('Demo code blocks on this page are inserted.');
    }

    Defer(generate_code_blocks, 0);
</script>
                </div>
            </div>

            <div class="example">
                <h3>Wait until the user starts interacting:</h3>
                <div class="helper">
                    Sometimes, you would like your code not to run unless there is user activity.
                    <br>
                    The third argument tells <code>Defer()</code> to delay the function
                    and wait until the user starts interacting with your page.
                </div>
                <div class="demo">
<style>
    @keyframes moving_bg {
        0%{background-position:0% 50%}
        50%{background-position:100% 50%}
        100%{background-position:0% 50%}
    }

    body.moving {
        background: linear-gradient(270deg, #ffffff, #e8f0c3, #ccf0c3);
        background-size: 600% 600%;
        animation: moving_bg 30s ease infinite;
    }
</style>

<script>
    function make_background_animate() {
        // jQuery is used in this example to attach a class to the <body> tag.
        // You won't see the animated background until you start interacting.
        $('body').addClass('moving');
    }

    Defer(make_background_animate, 0, true);
</script>
                </div>
            </div>

            <div class="example">
                <h3>The variable the <code>Defer.lazy()</code> method</h3>
                <div class="helper">
                    Setting <code>Defer.lazy=true</code> tells the library
                    to delay the execution of deferred scripts when the user
                    starts interacting with the page regardless of the page load event.
                    <br>
                    It will override the <code>waitForUserAction</code> argument
                    in the <code>Defer()</code> method.
                </div>
                <div class="demo">
<script>/* the script tag containing defer.min.js is here */</script>
<script>
    Defer.lazy = true;
</script>
                </div>
            </div>
        </section>

        <section>
            <h2><code>Defer.dom([selector], [delay], [unveiledClass], [resolver], [observeOptions])</code></h2>

            <div class="helper">
                The <code>Defer.dom()</code> method is useful in the below use cases:
                <ul>
                    <li>Lazy loading images, media, iframe tags, etc. on your website.</li>
                    <li>Prevent downloading third-party libraries or add-ons unless they are needed.</li>
                    <li>Scroll-reveal features, such as handling AJAX updating when a block is entering the viewport.</li>
                </ul>
                An element that was deferred by <code>Defer.dom()</code> will be unveiled as soon as this page finished loading.
            </div>

            <div class="example">
                <h3>For general using the <mark><code>data-src</code></mark> attribute:</h3>
                <div class="helper">
                    <code>&lt;template&gt;</code> tag in this example may be <code>&lt;img&gt;</code>, <code>&lt;iframe&gt;</code>, etc. in real scenarios.
                </div>
                <div class="demo">
<template data-src="example.com"
    data-title="This attribute will be copied to title attribute."></template>
<script>
    Defer.dom('[data-src]', 50, 'src-loaded');
</script>
                </div>
            </div>

            <div class="example">
                <h3>For general using class name (E.g: <mark><code>class="lazi"</code></mark>):</h3>
                <div class="helper">
                    <code>&lt;template&gt;</code> tag in this example may be <code>&lt;img&gt;</code>, <code>&lt;iframe&gt;</code>, etc. in real scenarios.
                </div>
                <div class="demo">
<template class="lazi"
    data-src="example.com"
    data-title="This attribute will be copied to title attribute."></template>
<script>
    Defer.dom('.lazi', 50, 'lazy-loaded');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Basic usage:</h3>
                <div class="helper">
                    The browser uses the <code>src</code> attribute of the tag to trigger the image load.
                    It doesn't matter if it is the first or the 1,000th image in your HTML.
                    If the browser gets the <code>src</code> attribute, it will trigger the image to be downloaded,
                    regardless of whether it is in or out of the current view.
                    <br>
                    To defer the load, put the image URL in an attribute other than <code>src</code>.
                    We specify the image URL in the <code>data-src</code> attribute of the image tag.
                    <br>
                    Sometimes, the <code>src</code> attribute could be used
                    to download a very small placeholder image before the real image gets downloaded.
                </div>
                <div class="demo">
<div id="demo-basic">
    <img alt="A lazy image"
        width="200" height="300" loading="lazy"
        data-src="https://picsum.photos/id/1003/200/300">
    <img alt="A lazy image with a low-resolution placeholder"
        width="200" height="300" loading="lazy"
        src="https://picsum.photos/id/1002/20/30?blur"
        data-src="https://picsum.photos/id/1002/200/300">
</div>
<script>
    Defer.dom('#demo-basic img');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a responsive image with <code>data-srcset</code> and <code>data-sizes</code> attributes:</h3>
                <div class="helper">
                    Using the <code>srcset</code> attribute has made responsive image sizing much simpler.
                    It allows you to define a list of differently-sized versions of the same image,
                    and provide information about the size of each one.
                    Then, the client (browser) gets to make the decision.
                    <br>
                    We can also use the same trick as the above examples.
                    We specify an image URL set in the <code>data-srcset</code> attribute of the image tag.
                </div>
                <div class="demo">
<div id="demo-srcset">
    <img alt="A lazy image with srcset attribute"
        width="200" height="300" loading="lazy" data-sizes="200w"
        src="https://picsum.photos/id/204/20/30?blur"
        data-src="https://picsum.photos/id/204/200/300"
        data-srcset="https://picsum.photos/id/204/400/600 2x, https://picsum.photos/id/204/600/900 3x">
</div>
<script>
    Defer.dom('#demo-srcset img');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a responsive image with flexible format selection:</h3>
                <div class="helper">
                    Different browsers support different image formats.
                    We might want to send a fancy new image format such as WebP
                    to browsers that can render it,
                    and fall back to trusty old JPEGs in browsers that donâ€™t.
                    <br>
                    We can also use the same trick as the above examples for <code>picture</code> tags,
                    and their children's HTML nodes.
                </div>
                <div class="demo">
<div id="demo-picture">
    <picture>
        <source type="image/webp" data-sizes="200w"
            data-src="https://picsum.photos/id/1054/200/300.webp"
            data-srcset="https://picsum.photos/id/1054/400/600.webp 2x, https://picsum.photos/id/1054/600/900.webp 3x">
        <img alt="A lazy image with srcset attribute"
            width="200" height="300" loading="lazy" data-sizes="200w"
            src="https://picsum.photos/id/1054/20/30?blur"
            data-src="https://picsum.photos/id/1054/200/300"
            data-srcset="https://picsum.photos/id/1054/400/600 2x, https://picsum.photos/id/1054/600/900 3x">
    </picture>
</div>
<script>
    Defer.dom('#demo-picture picture');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Basic usage with adding CSS class:</h3>
                <div class="helper">
                    the <code>Defer.dom()</code> method also allows you to add CSS class names when a node is unveiled.
                    <br>
                    In this example, we will add some CSS class names to make the <code>img</code> tag animate.
                </div>
                <div class="demo">
<div id="demo-basic2">
    <img alt="A lazy image with animation when loaded"
        width="200" height="300" loading="lazy"
        src="https://picsum.photos/id/1024/20/30?blur"
        data-src="https://picsum.photos/id/1024/200/300">
</div>
<script>
    // this example is using animate.css library
    // see: https://animate.style
    Defer.dom('#demo-basic2 img', 0, 'animate__animated animate__backInLeft');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load inline CSS background images:</h3>
                <div class="helper">
                    We can also defer background images for any HTML tag other than <code>img</code> or <code>picture</code>.
                </div>
                <div class="demo">
<style>
    #demo-inline .image {
        display: inline-block;
        height: 300px;
        width: 200px;
        background: transparent 0 0 / cover no-repeat;
        border-radius: 150px;
    }
</style>
<div id="demo-inline">
    <div class="image" data-style="background-image:url(https://picsum.photos/id/1068/400/600)"></div>
    <div class="image" data-style="background-image:url(https://picsum.photos/id/1069/400/600)"></div>
    <div class="image" data-style="background-image:url(https://picsum.photos/id/1070/400/600)"></div>
</div>
<script>
    Defer.dom('#demo-inline .image');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load CSS background images:</h3>
                <div class="helper">
                    Still deferring background images for HTML tags, but we can also use CSS class names instead of inline <code>style</code> attributes.
                </div>
                <div class="demo">
<style>
    #demo-css .image {
        display: inline-block;
        height: 300px;
        width: 200px;
        background: transparent 0 0 / cover no-repeat;
        border-radius: 150px;
    }
    #pic1.shown {
        background-image: url(https://picsum.photos/id/106/400/600);
    }
    #pic2.shown {
        background-image: url(https://picsum.photos/id/206/400/600);
    }
    #pic3.shown {
        background-image: url(https://picsum.photos/id/306/400/600);
    }
</style>
<div id="demo-css">
    <div id="pic1" class="image"></div>
    <div id="pic2" class="image"></div>
    <div id="pic3" class="image"></div>
</div>
<script>
    Defer.dom('#demo-css .image', 0, 'shown');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a video:</h3>
                <div class="helper">
                    With the <code>Defer.dom()</code> method, we can also defer the load of various media tags, such as a <code>video</code> tag.
                </div>
                <div class="demo">
<div id="demo-video">
    <video autoplay="true" controls="true" muted="true" width="480" height="270"
        data-poster="https://storage.googleapis.com/gtv-videos-bucket/sample/images/ForBiggerFun.jpg">
        <source type="video/mp4" data-src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4">
        <!-- <source type="video/ogg" data-src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.ogg"> -->
        <!-- <source type="video/avi" data-src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.avi"> -->
    </video>
</div>
<script>
    Defer.dom('#demo-video video', 0, 'shown');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load an iframe:</h3>
                <div class="helper">
                    With the <code>Defer.dom()</code> method, we can effortlessly defer the load of <code>iframe</code> tags.
                </div>
                <div class="demo">
<div id="demo-iframe">
    <iframe title="An iframe example"
        width="480" height="270" frameborder="0"
        src="about:blank"
        data-src="https://shinsenter.github.io/defer.js/">
    </iframe>
</div>
<script>
    Defer.dom('#demo-iframe iframe', 0, 'iframe-loaded');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a Youtube video:</h3>
                <div class="helper">
                    This example uses the <code>Defer.dom()</code> method to defer a load of a Youtube iframe.
                </div>
                <div class="demo">
<div id="demo-youtube">
    <iframe title="The new MacBook Air"
        width="480" height="270" frameborder="0" allowfullscreen=""
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        src="about:blank"
        data-src="https://www.youtube.com/embed/jwmS1gc9S5A"
        data-style="background: transparent url(https://img.youtube.com/vi/jwmS1gc9S5A/hqdefault.jpg) 50% 50% / cover no-repeat;">
    </iframe>
</div>
<script>
    Defer.dom('#demo-youtube iframe', 0, 'youtube-loaded');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a Facebook post:</h3>
                <div class="helper">
                    This example uses the <code>Defer.dom()</code> method to defer a load of a Facebook post.
                </div>
                <div class="demo">
<div id="demo-facebook">
    <iframe title="An example of Facebook post"
        width="480" height="270" frameborder="0"
        scrolling="no" allowTransparency="true" allow="encrypted-media"
        src="about:blank"
        data-src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fappseeds%2Fposts%2F1502937099839267&width=480&show_text=true&height=200">
    </iframe>
</div>
<script>
    Defer.dom('#demo-facebook iframe', 0, 'facebook-loaded');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a Discord chat box:</h3>
                <div class="helper">
                    This example uses the <code>Defer.dom()</code> method to defer a load of a Discord chat box.
                </div>
                <div class="demo">
<iframe id="discord-widget" title="Discord"
    width="480" height="270" frameborder="0"
    allowtransparency="true"
    sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"
    src="about:blank"
    data-src="https://discord.com/widget?id=962919929307357234&theme=dark">
</iframe>
<script>
    Defer.dom('#discord-widget', 0, 'discord-loaded');
</script>
                </div>
            </div>

            <div class="example">
                <h3>Scroll and reveal:</h3>
                <div class="helper">
                    the <code>Defer.dom()</code> method also helps you to do an action when an element is unveiled.
                    <br>
                    With the below example, when you scroll to the bottom of this page,
                    you will see a message as soon as a tag with <code>id="surprise-me"</code> appears.
                </div>
                <div class="demo">
<script>
    Defer.dom('#surprise-me', 1000, 'seen', function(node) {
        alert('Yay!\nYou have seen all examples. Have fun with Defer.js!');
    });
</script>
                </div>
            </div>
        </section>

        <section>
            <h2><code>Defer.css(fileUrl, [id], [delay], [onload], [waitForUserAction])</code></h2>

            <div class="helper">
                We use the <code>Defer.css()</code> method to defer a load of external CSS files without blocking the page rendering.
                <br>
                <strong>Note: </strong>
                Lazy loading behavior changed since v3.0
                when you set <code>Defer.lazy=true</code> or <code>waitForUserAction=true</code>. <br>
                The <code>fileUrl</code> will not be fetched unless the user starts interacting with your page.
            </div>

            <div class="example">
                <h3>Lazy load FontAwesome library:</h3>
                <div class="helper">
                    Using the <code>Defer.css()</code> method to lazy load FontAwesome (CSS and some font files).
                </div>
                <div class="demo">
<style>
    #demo-fontawesome .far {
        font-size: 3em;
        color: green;
    }
</style>

<div id="demo-fontawesome">
    <i class="far fa-thumbs-up"></i>
    <code>@shinsenter/defer.js</code>
</div>

<script>
    var fileUrl = 'https://pro.fontawesome.com/releases/v5.14.0/css/all.css';

    Defer.css(fileUrl, 'fa5-css', 0, function() {
        console.info('FontAwesome is loaded.'); // debug
    });
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load animate.css library:</h3>
                <div class="helper">
                    The download of Animate.css library will wait
                    for the first user interaction with your page.
                    When the Animate.css library was downloaded,
                    we will add CSS classes from Animate.css to every
                    tag with <code>class="demo"</code> on this page.
                    <br>
                    However, no tag will be animated unless you scroll to its position.
                </div>
                <div class="demo">
<script>
    var origin = 'https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1';

    // This script will lazy load animate.css library.
    Defer.css(origin + '/animate.min.css', 'animate-css', 0, function () {
        console.info('Animate.css is loaded.'); // debug

        // adds animation classes to demo blocks.
        Defer.dom('.demo', 100, 'animate__animated animate__fadeIn');
    });
</script>
                </div>
            </div>
        </section>

        <section>
            <h2><code>Defer.js(fileUrl, [id], [delay], [onload], [waitForUserAction])</code></h2>

            <div class="helper">
                We use the <code>Defer.js()</code> method to defer a load of 3rd-party JavaScript libraries, add-ons etc. without blocking the page rendering.
                <br>
                <strong>Note 1: </strong>
                Because the download of a file using the <code>Defer.js()</code> method is asynchronous,
                to avoid dependency error when lazy loading a library using the <code>Defer.js()</code> method,
                it is highly recommended that the <code>onload</code> callback function be used to make sure that
                the third-party library you needed is completely defined.
                <br>
                <strong>Note 2: </strong>
                Lazy loading behavior changed since v3.0
                when you set <code>Defer.lazy=true</code> or <code>waitForUserAction=true</code>. <br>
                The <code>fileUrl</code> will not be fetched unless the user starts interacting with your page.
            </div>

            <div class="example">
                <h3>An alternative way to lazy load Google Tag Manager script:</h3>
                <div class="helper">
                    Using the <code>Defer.js()</code> method to lazy load Google Tag Manager library and its external scripts.
                </div>
                <div class="demo">
<script>
    var GTM_ID = 'UA-34520609-2';
    window.dataLayer = window.dataLayer || [];
    dataLayer.push(['js', new Date()]);
    dataLayer.push(['config', GTM_ID]);

    // Lazy loads the GTM library
    // in this example, we want the GTM to execute as soon as the page is loaded
    // so the waitForUserAction argument (the last argument) is set to false.
    Defer.js('https://www.googletagmanager.com/gtag/js?id=' + GTM_ID, 'google-tag', 0, function() {
        console.info('Google Tag Manager is loaded.'); // debug
    }, false);
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load AddThis add-on:</h3>
                <div class="helper">
                    Using the <code>Defer.js()</code> method to lazy load AddThis add-on and its assets.
                    <br>
                    AddThis add-on will not be loaded until the user starts interacting with the page.
                </div>
                <div class="demo">
<div class="demo-addthis addthis_inline_share_toolbox"></div>

<script>
    var fileUrl = 'https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c68e61cf456f1cb';

    Defer.js(fileUrl, 'addthis-js', 0, function() {
        console.info('AddThis add-on is loaded.'); // debug
    }, true);
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load Prism.js library:</h3>
                <div class="helper">
                    Using the <code>Defer.js()</code> method to lazy load Prism.js library and its assets.
                    <br>
                    The <code>"Code:"</code> blocks on this page will be rendered only when you scroll to their positions.
                </div>
                <div class="demo">
<style>
    pre {
        background-color: honeydew;
    }
</style>

<script>
    // turns on manual mode
    window.Prism = window.Prism || {};
    Prism.manual = true;

    // this script will lazy load Prism.js library and its dark theme.
    // when loading is done, it will apply code formatting to every <code> tag.
    var origin = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0';
    Defer.css(origin + '/themes/prism-tomorrow.min.css', 'prism-css');
    Defer.js(origin + '/prism.min.js', 'prism-js', 0, function () {
        // enables code highlighting for code tags using Defer.dom()
        Defer.dom('pre code', 100, 'ide-loaded', Prism.highlightElement, {rootMargin: "120%"});

        console.info('Prism.js is loaded.'); // debug
    });
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load a Twitter post or timeline:</h3>
                <div class="helper">
                    This example uses the <code>Defer.js()</code> and the <code>Defer.dom()</code> method to defer a load of a Twitter post or timeline.
                </div>
                <div class="demo">
<div id="demo-twitter">
    <a class="lazy-timeline"
        href="https://twitter.com/TwitterDev"
        data-chrome="nofooter noborders"
        data-height="400" data-dnt="true" data-theme="dark">
        Tweets by @TwitterDev
    </a>

    <blockquote class="lazy-tweet" data-dnt="true" data-theme="dark"><p lang="en" dir="ltr">The new CEO of Twitter is amazing <a href="https://t.co/yBqWFUDIQH">pic.twitter.com/yBqWFUDIQH</a></p>&mdash; Elon Musk (@elonmusk) <a href="https://twitter.com/elonmusk/status/1625695877326340102?ref_src=twsrc%5Etfw">February 15, 2023</a></blockquote>
</div>
<script>
Defer.js('https://platform.twitter.com/widgets.js', 'twitter-sdk', 0, function() {
    Defer.dom('.lazy-timeline', 0, 'twitter-loaded', function(node) {
        // adds the correct class name for tweet element
        node.className += ' twitter-timeline';

        // For better performance,
        // we only search within the parent DOM tree for uninitialized widgets
        twttr.widgets.load(node.parentNode);
        console.info('Twitter timeline is loaded.'); // debug
    }, {rootMargin: "200%"});

    Defer.dom('.lazy-tweet', 0, 'twitter-loaded', function(node) {
        // adds the correct class name for timeline element
        node.className += ' twitter-tweet';

        // For better performance,
        // we only search within the parent DOM tree for uninitialized widgets
        twttr.widgets.load(node.parentNode);
        console.info('Twitter post is loaded.'); // debug
    }, {rootMargin: "200%"});
});
</script>
                </div>
            </div>

            <div class="example">
                <h3>Lazy load an Instagram post:</h3>
                <div class="helper">
                    This example uses the <code>Defer.js()</code> and the <code>Defer.dom()</code> method to defer a load of an Instagram post.
                </div>
                <div class="demo">
<div id="demo-instagram">
    <blockquote class="lazy-instagram" data-instgrm-captioned data-instgrm-permalink="https://www.instagram.com/reel/CiNz7t9rESH/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/reel/CiNz7t9rESH/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">View this post on Instagram</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/reel/CiNz7t9rESH/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">A post shared by apple (@apple)</a></p></div></blockquote>
</div>
<script>
Defer.js('https://www.instagram.com/embed.js', 'instagram-sdk', 0, function() {
    Defer.dom('.lazy-instagram', 0, 'instagram-loaded', function(node) {
        // adds the correct class name for instagram post
        node.className += ' instagram-media';

        // For better performance,
        // we only search within the parent DOM tree for uninitialized widgets
        instgrm.Embeds.process(node.parentNode);
        console.info('Instagram post is loaded.'); // debug
    }, {rootMargin: "200%"});
});
</script>
                </div>
            </div>
        </section>

        <hr>

        <footer id="surprise-me">
            <p>Have fun with <a href="https://code.shin.company/defer.js" title="@shinsenter/defer.js">@shinsenter/defer.js</a>!</p>
        </footer>
    </main>

    <!-- Issue #121 (https://code.shin.company/defer.js/issues/121) -->
    <script type="issue-121">
        document.getElementById('navs').innerHTML = [
            '<li><a href="#installation">Getting started<\/a><\/li>',
            '<li><a href="#examples">View examples<\/a><\/li>',
        ].join('');
    </script>
    <script>
        Defer.all('script[type="issue-121"]', 0, true);
    </script>

    <!-- Dummy -->
    <script>Defer.all('script[type="waterfall-test-defer"]', 1000, false);</script>
    <script>Defer.all('script[type="waterfall-test-lazy"]',  1000, true);</script>
    <script type="waterfall-test-defer" data-order="01" src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.38/vue.cjs.js"></script>
    <script type="waterfall-test-defer" data-order="02" src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script type="waterfall-test-defer" data-order="03" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/js/bootstrap.min.js"></script>
    <script type="waterfall-test-defer" data-order="04" src="https://cdnjs.cloudflare.com/ajax/libs/create-react-class/15.7.0/create-react-class.min.js"></script>
    <script type="waterfall-test-defer" data-order="05" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <script type="waterfall-test-defer" data-order="05b">console.debug('defer-05b');</script>
    <script type="waterfall-test-defer" data-order="06" src="https://cdnjs.cloudflare.com/ajax/libs/typescript/4.8.2/typescript.min.js"></script>
    <script type="waterfall-test-defer" data-order="07" src="https://cdnjs.cloudflare.com/ajax/libs/antd/4.22.8/antd.min.js"></script>
    <script type="waterfall-test-defer" data-order="08" src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script type="waterfall-test-defer" data-order="09" src="https://cdnjs.cloudflare.com/ajax/libs/react-is/18.2.0/umd/react-is.production.min.js"></script>
    <script type="waterfall-test-defer" data-order="10" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/js/bootstrap.min.js"></script>
    <script type="waterfall-test-defer" data-order="10b">console.debug('defer-10b');</script>
    <script type="waterfall-test-defer" data-order="11" src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.6.1/d3.min.js"></script>
    <script type="waterfall-test-defer" data-order="12" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.144.0/three.min.js"></script>
    <script type="waterfall-test-defer" data-order="13" src="https://cdnjs.cloudflare.com/ajax/libs/angular/12.2.16/core.umd.min.js"></script>
    <script type="waterfall-test-defer" data-order="14" src="https://cdnjs.cloudflare.com/ajax/libs/material-ui/4.12.4/index.js"></script>
    <script type="waterfall-test-defer" data-order="15" src="https://cdnjs.cloudflare.com/ajax/libs/angular-aria/1.8.3/angular-aria.min.js"></script>
    <script type="waterfall-test-defer" data-order="15b">console.debug('defer-15b');</script>
    <script type="waterfall-test-defer" data-order="16" src="https://cdnjs.cloudflare.com/ajax/libs/angular-animate/1.8.3/angular-animate.min.js"></script>
    <script type="waterfall-test-defer" data-order="17" src="https://cdnjs.cloudflare.com/ajax/libs/angular-loader/1.8.3/angular-loader.min.js"></script>
    <script type="waterfall-test-lazy" data-order="01" src="https://cdnjs.cloudflare.com/ajax/libs/angular-cookies/1.8.3/angular-cookies.min.js"></script>
    <script type="waterfall-test-lazy" data-order="02" src="https://cdnjs.cloudflare.com/ajax/libs/angular-message-format/1.8.3/angular-message-format.min.js"></script>
    <script type="waterfall-test-lazy" data-order="03" src="https://cdnjs.cloudflare.com/ajax/libs/angular-parse-ext/1.8.3/angular-parse-ext.min.js"></script>
    <script type="waterfall-test-lazy" data-order="04" src="https://cdnjs.cloudflare.com/ajax/libs/angular-resource/1.8.3/angular-resource.min.js"></script>
    <script type="waterfall-test-lazy" data-order="05" src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.8.3/angular-route.min.js"></script>
    <script type="waterfall-test-lazy" data-order="05b">console.debug('lazy-05b');</script>
    <script type="waterfall-test-lazy" data-order="06" src="https://cdnjs.cloudflare.com/ajax/libs/angular-sanitize/1.8.3/angular-sanitize.min.js"></script>
    <script type="waterfall-test-lazy" data-order="07" src="https://cdnjs.cloudflare.com/ajax/libs/angular-touch/1.8.3/angular-touch.min.js"></script>
    <script type="waterfall-test-lazy" data-order="08" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <script type="waterfall-test-lazy" data-order="09" src="https://cdnjs.cloudflare.com/ajax/libs/angular-i18n/1.8.3/angular-locale_en-us.min.js"></script>
    <script type="waterfall-test-lazy" data-order="10" src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.js"></script>
    <script type="waterfall-test-lazy" data-order="10b">console.debug('lazy-10b');</script>
    <script type="waterfall-test-lazy" data-order="11" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script type="waterfall-test-lazy" data-order="12" src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.2.0/redux.min.js"></script>
    <script type="waterfall-test-lazy" data-order="13" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script type="waterfall-test-lazy" data-order="14" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <script type="waterfall-test-lazy" data-order="15" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-compat/3.0.0-alpha1/jquery.min.js"></script>
    <script type="waterfall-test-lazy" data-order="15b">console.debug('lazy-15b');</script>
    <script type="waterfall-test-lazy" data-order="16" src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.9/index.js"></script>
    <script type="waterfall-test-lazy" data-order="17" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.3.3/echarts.min.js"></script>
    <script type="waterfall-test-lazy" data-order="18" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.6/mermaid.min.js"></script>
    <script type="waterfall-test-lazy" data-order="19" src="https://code.jquery.com/jquery-3.6.3.slim.min.js" integrity="sha256-ZwqZIVdD3iXNyGHbSYdsmWP//UBokj2FHAxKuSBKDSo=" crossorigin="anonymous"></script>
</body>

</html>